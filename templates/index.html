<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>OK Chat AI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body data-loggedin="{{ 'true' if logged_in else '' }}">
  <div class="container">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-top">
        <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo" class="logo">
        <button class="new-chat-btn" onclick="startNewChat()">+ New Chat</button>
        <div id="auth-status"></div>
      </div>
      <input type="text" id="searchInput" placeholder="Search chats..." oninput="filterChats()">
      <div class="history" id="history"></div>
    </aside>

    <!-- Chat Area -->
    <main class="chat-main">
      <header class="chat-header">
        <div class="auth-buttons">
          {% if not logged_in %}
            <button onclick="openAuthModal('login')">Login</button>
            <button onclick="openAuthModal('signup')">Sign Up</button>
          {% else %}
            <button onclick="openProfileModal()">Profile ‚öôÔ∏è</button>
            <button onclick="logoutUser()">Logout</button>
          {% endif %}
        </div>
        <button class="dark-toggle" onclick="toggleDarkLight()">üåì</button>
      </header>

      <!-- Welcome overlay -->
      <div id="welcome-title">OK is here</div>

      <div class="chat-container" id="chat"></div>

      <div class="chat-input-wrapper">
        <input type="text" id="message" placeholder="Type a message..." onkeydown="if(event.key==='Enter'){sendMessage()}">
        <button id="sendBtn" onclick="sendMessage()">Send</button>
      </div>

      <footer class="chat-footer">
        Made by Khallouk Oussama
      </footer>
    </main>
  </div>

  <!-- Auth Modal -->
  <div id="auth-modal" class="auth-modal">
    <div class="auth-content">
      <span class="close" onclick="closeAuthModal()">&times;</span>

      <!-- Login -->
      <div id="login-form">
        <h2>Login</h2>
        <input type="email" id="login-email" placeholder="Email">
        <input type="password" id="login-password" placeholder="Password">
        <button onclick="login()">Login</button>
        <hr>
        <button class="google-login" onclick="googleLogin()">Login with Google</button>
      </div>

      <!-- Signup -->
      <div id="signup-form">
        <h2>Sign Up</h2>
        <input type="email" id="signup-email" placeholder="Email">
        <input type="password" id="signup-password" placeholder="Password">
        <button onclick="signup()">Sign Up</button>
      </div>
    </div>
  </div>

  <!-- Profile Settings Modal -->
  <div id="profile-modal" class="auth-modal">
    <div class="auth-content">
      <span class="close" onclick="closeProfileModal()">&times;</span>
      <h2>Profile Settings</h2>
      <input type="password" id="new-password" placeholder="New Password">
      <button onclick="changePassword()">Change Password</button>
      <hr>
      <button class="delete-account" onclick="deleteAccount()">Delete Account ‚ùå</button>
    </div>
  </div>

  <script src="{{ url_for('static', filename='script.js') }}"></script>
  <script>
    // Logout button for header
    function logoutUser() {
      fetch('/logout')
        .then(() => location.reload())
        .catch(err => console.error(err));
    }

    // Hide modals if clicked outside
    window.onclick = function(event) {
      const authModal = document.getElementById("auth-modal");
      const profileModal = document.getElementById("profile-modal");
      if (event.target === authModal) closeAuthModal();
      if (event.target === profileModal) closeProfileModal();
    }
  </script>
</body>
</html>
